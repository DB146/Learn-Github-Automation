name: Generate Keystore

on: 
  workflow_dispatch:

jobs:
  generate-key:
    runs-on: ubuntu-latest
    steps:
      - name: Set up Java
        uses: actions/setup-java@v4
        with:
          distribution: 'zulu'
          java-version: '17'

      - name: Generate Keystore
        run: |
          echo "ðŸ” Generating Keystore..."
          
          # Generate a standard Android signing key (PKCS12 is standard for modern Java)
          keytool -genkeypair -v \
            -keystore revanced.keystore \
            -alias revanced \
            -keyalg RSA \
            -keysize 2048 \
            -validity 10000 \
            -storepass password123 \
            -keypass password123 \
            -storetype pkcs12 \
            -dname "CN=ReVanced, OU=Personal, O=Personal, L=Unknown, S=Unknown, C=Unknown"
          
          # Convert to Base64 (single line, no wrap)
          base64 -w 0 revanced.keystore > keystore_base64.txt
          
          # Read into variable for display
          BASE64_KEY=$(cat keystore_base64.txt)
          
          echo "## ðŸ”‘ Your New Keystore" >> $GITHUB_STEP_SUMMARY
          echo "### âš ï¸ Instructions" >> $GITHUB_STEP_SUMMARY
          echo "1. Download the artifact 'keystore-text' from the bottom of this page (safest)." >> $GITHUB_STEP_SUMMARY
          echo "2. OR Copy the text block below carefully." >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "Go to **Settings > Secrets and variables > Actions** and add:" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "| Name | Value |" >> $GITHUB_STEP_SUMMARY
          echo "|---|---|" >> $GITHUB_STEP_SUMMARY
          echo "| \`KEYSTORE_PASSWORD\` | \`password123\` |" >> $GITHUB_STEP_SUMMARY
          echo "| \`KEYSTORE_ALIAS\` | \`revanced\` |" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "### Secret: \`KEYSTORE_FILE\`" >> $GITHUB_STEP_SUMMARY
          echo "\`\`\`" >> $GITHUB_STEP_SUMMARY
          echo "$BASE64_KEY" >> $GITHUB_STEP_SUMMARY
          echo "\`\`\`" >> $GITHUB_STEP_SUMMARY

      - name: Upload Base64 Text File
        uses: actions/upload-artifact@v4
        with:
          name: keystore-text
          path: keystore_base64.txt
